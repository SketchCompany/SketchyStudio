<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Outfit:wght@100..900&family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <!-- custom resources -->
    <title>Studio | Sketchy Studio</title>
    <link rel="stylesheet" href="/res?f=css/body.css">
    <link rel="stylesheet" href="/res?f=css/studio.css">
</head>
<body>
    <main>
        <h1>Im Studio</h1>
        <p>Hier kannst du neue Projekte erstellen und an deinen anderen weiterarbeiten.</p>
        <div class="projects">
            <h2>Projekte</h2>
            <div class="projectsContainer">
                <div class="create">
                    <div>
                        <i class="bi bi-plus"></i>
                    </div>
                    <p>Neues Projekt</p>
                </div>
            </div>
            <!-- <h3>Andere Projekte</h3>
            <div class="otherProjectsContainer"></div> -->
        </div>
    </main>
    <script src="/res?f=app.js"></script>
    <script>
        $(".create").click(createProject)

        async function createProject(){
            const dialog = createDialog("Projekt erstellen", "Gebe den Namen und eine kurze Beschreibung für das neue Projekt an.", `
                <div class="crow">
                    <p>Projektname:</p>
                    <span id="nameInvalid" class="input-validator">
                        <p style="opacity: 0;">Ungültiger Name</p>
                        <input id="projectName" type="text" maxlength="30" placeholder="Der Projektname">
                    </span>
                </div>
                <div class="crow">
                    <p>Beschreibung:</p>
                    <span id="descriptionInvalid" class="input-validator">
                        <p style="opacity: 0;">Ungültiger Name</p>
                        <input id="projectDescription" maxlength="50" type="text" placeholder="Die Beschreibung">
                    </span>
                </div>
                <button id="createProject" class="marked">Projekt erstellen</button>
            `, 500)
            
            $("#projectName").keyup(function(e){
                const name = $("#projectName").val()
                if(!/\S/.test(name)){
                    setNameInvalid("Projektname leer")
                }
                else if(hasInvalidChars(name)){
                    setNameInvalid("Projektname enthält ungültige Zeichen")
                }
                else if(name.length < 3){
                    setNameInvalid("Projektname zu kurz")
                }
                else if(name.length > 30){
                    setNameInvalid("Projektname zu lang")
                }
                else{   
                    setNameValid("Der Projektname ist perfekt")
                }
            })

            $("#projectDescription").keyup(function(e){
                const description = $("#projectDescription").val()
                if(!/\S/.test(description)){
                    setNameInvalid("Beschreibung leer")
                }
                else if(hasInvalidChars(description)){
                    setNameInvalid("Beschreibung enthält ungültige Zeichen")
                }
                else if(description.length < 0){
                    setNameInvalid("Beschreibung zu kurz")
                }
                else if(description.length > 50){
                    setNameInvalid("Beschreibung zu lang")
                }
                else{   
                    setNameValid("Der Beschreibung ist perfekt")
                }
            })

            function setNameInvalid(text){
                $("#nameInvalid").children().first().css("opacity", "1")
                if($("#nameInvalid").hasClass("valid")) $("#nameInvalid").removeClass("valid")            
                $("#nameInvalid").addClass("invalid")
                $("#nameInvalid").children().first().html(text)
            }
            function setNameValid(text){
                $("#nameInvalid").children().first().css("opacity", "1")
                if($("#nameInvalid").hasClass("invalid")) $("#nameInvalid").removeClass("invalid")            
                $("#nameInvalid").addClass("valid")
                $("#nameInvalid").children().first().html(text)
            }
            function setDescriptionInvalid(text){
                $("#descriptionInvalid").children().first().css("opacity", "1")
                if($("#descriptionInvalid").hasClass("valid")) $("#descriptionInvalid").removeClass("valid")            
                $("#descriptionInvalid").addClass("invalid")
                $("#descriptionInvalid").children().first().html(text)
            }
            function setDescriptionValid(text){
                $("#descriptionInvalid").children().first().css("opacity", "1")
                if($("#descriptionInvalid").hasClass("invalid")) $("#descriptionInvalid").removeClass("invalid")            
                $("#descriptionInvalid").addClass("valid")
                $("#descriptionInvalid").children().first().html(text)
            }
            
            // const res = await authSend("/b/create", {name, description})
            // console.log(res)
        }

        function hasInvalidChars(text){
            if(text.includes("\"") ||
                text.includes("§") ||
                text.includes("$") ||
                text.includes("%") ||
                text.includes("&") ||
                text.includes("/") ||
                text.includes("\\") ||
                text.includes("=") ||
                text.includes("?") ||
                text.includes("`") ||
                text.includes("´") ||
                text.includes("*") ||
                text.includes(",") ||
                text.includes(";") ||
                text.includes(":") ||
                text.includes("<") ||
                text.includes(">") ||
                text.includes("²") ||
                text.includes("³") ||
                text.includes("{") ||
                text.includes("}") ||
                text.includes("[") ||
                text.includes("]") ||
                text.includes("^") ||
                text.includes("|") ||
                text.includes("~") ||
                text.includes("@") ||
                text.includes("€")
            ) return true
            else return false
        }

        const timeout = setTimeout(() => {
            $("#5001").remove()
        }, 1000)
        $("#5001").on("load", function(){
            clearTimeout(timeout)
        })
    </script>
</body>
</html>