<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script>
        if(!localStorage.getItem("token")) open("/login?r=/studio", "_self")
    </script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Outfit:wght@100..900&family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>

    <!-- custom resources -->
    <title>Studio | Sketchy Studio</title>
    <link rel="preconnect" href="https://api.sketch-company.de">
    <link rel="stylesheet" href="/res?f=css/project.css">

    <!-- imports from project -->
</head>
<body class="default">
    <sketchystudio>

    </sketchystudio>
    <div class="coffcanvas" style="display: none;">
        <div class="content">
            <div class="top">
                <div class="title">
                    <span class="bi bi-wrench-adjustable"></span>
                    <h3>Tools</h3>
                </div>
                <span class="bi bi-arrow-bar-left" onclick="sketchyStudio.toggleOffcanvas()"></span>
            </div>
            <div class="body">
                <div class="crow">
                    <div class="crow-stack">
                        <div class="crow-flex">
                            <p>Name:</p>
                            <input id="tool-name" type="text" placeholder="h1, p, button, input, ...">
                        </div>
                        <div class="crow-flex element-info fill">
                            <p>Element:</p>
                            <pre id="tool-element">asda sdasd asd as d</pre>
                        </div>
                    </div>
                </div>
                <div class="crow">
                    <div class="crow-stack">
                        <div class="crow-flex fill">
                            <p>Text:</p>
                            <textarea id="tool-content" placeholder="Inhalt des Elements..."></textarea>
                        </div>
                        <div class="crow-flex">
                            <p>Ausrichtung:</p>
                            <select id="tool-content-align">
                                <option value="start">start (Standard)</option>
                                <option value="center">center</option>
                                <option value="end">end</option>
                                <option value="justify">justify</option>
                                <option value="left">left (Standard)</option>
                                <option value="right">right</option>
                                <option value="inherit">inherit</option>
                                <option value="initial">initial</option>
                                <option value="unset">unset</option>
                            </select>
                        </div>
                    </div>
                    
                </div>
                <div class="crow">
                    <p>Schriftgröße:</p>
                    <input id="tool-font-size" type="text" inputmode="numeric" placeholder="16px">
                </div>
                <div class="crow">
                    <div class="crow-stack">
                        <div class="crow-flex">
                            <p>Schriftfarbe:</p>
                            <input id="tool-color" type="color">
                        </div>
                        <div class="crow-flex">
                            <p>Transparenz:</p>
                            <span class="slider">
                                <input id="tool-color-transparancy-field" type="text" inputmode="numeric" placeholder="100">
                                <input id="tool-color-transparancy-range" type="range" min="0" max="100" value="100">
                            </span>
                        </div>
                    </div>
                </div>
                <div class="crow">
                    <div class="crow-stack">
                        <div class="crow-flex">
                            <p>Hintergrundfarbe:</p>
                            <input id="tool-background-color" type="color">
                        </div>
                        <div class="crow-flex">
                            <p>Transparenz:</p>
                            <span class="slider">
                                <input id="tool-background-color-transparancy-field"type="text" inputmode="numeric" placeholder="100">
                                <input id="tool-background-color-transparancy-range" type="range" min="0" max="100" value="100">
                            </span>
                        </div>
                    </div>
                </div>
                <div class="crow">
                    <p>Einrückung:</p>
                    <div class="ccolumn grid">
                        <input id="tool-padding-top" type="text" inputmode="numeric" placeholder="Oben">
                        <input id="tool-padding-left" type="text" inputmode="numeric" placeholder="Links">
                        <input id="tool-padding-right" type="text" inputmode="numeric" placeholder="Rechts">
                        <input id="tool-padding-bottom" type="text" inputmode="numeric" placeholder="Unten">
                    </div>
                </div>
                <div class="crow">
                    <div class="crow-stack">
                        <div class="crow-flex">
                            <p>Rand Farbe:</p>
                            <input id="tool-border-color" type="color">
                        </div>
                        <div class="crow-flex">
                            <p>Transparenz:</p>
                            <span class="slider">
                                <input id="tool-border-color-transparancy-field" type="text" inputmode="numeric" placeholder="100">
                                <input id="tool-border-color-transparancy-range" type="range" min="0" max="100" value="100">
                            </span>
                        </div>
                    </div>
                </div>
                <div class="crow">
                    <p>Rand Breite:</p>
                    <div class="ccolumn grid">
                        <input id="tool-border-width-top" type="text" inputmode="numeric" placeholder="Oben">
                        <input id="tool-border-width-left" type="text" inputmode="numeric" placeholder="Links">
                        <input id="tool-border-width-right" type="text" inputmode="numeric" placeholder="Rechts">
                        <input id="tool-border-width-bottom" type="text" inputmode="numeric" placeholder="Unten">
                    </div>
                </div>
                <div class="crow">
                    <p>Position:</p>
                    <select id="tool-position">
                        <option value="initial">initial (Standard)</option>
                        <option value="absolute">absolute</option>
                        <option value="fixed">fixed</option>
                        <option value="relative">relative</option>
                        <option value="static">static</option>
                        <option value="-ms-page">-webkit-sticky</option>
                        <option value="inherit">inherit</option>
                        <option value="unset">unset</option>
                    </select>
                </div>
                <div class="crow">
                    <p>Anzeige:</p>
                    <select id="tool-display">
                        <!-- Grundlegende Display-Werte -->
                        <option value="block">block (Standard)</option>
                        <option value="inline">inline</option>
                        <option value="inline-block">inline-block</option>
                        <option value="none">none</option>
                    
                        <!-- Flexbox und Grid -->
                        <option value="flex">flex</option>
                        <option value="inline-flex">inline-flex</option>
                        <option value="grid">grid</option>
                        <option value="inline-grid">inline-grid</option>
                    
                        <!-- Positionierung von Listen -->
                        <option value="list-item">list-item</option>
                    
                        <!-- Table und verwandte Werte -->
                        <option value="table">table</option>
                        <option value="table-row">table-row</option>
                        <option value="table-cell">table-cell</option>
                        <option value="table-column">table-column</option>
                        <option value="table-column-group">table-column-group</option>
                        <option value="table-row-group">table-row-group</option>
                        <option value="table-header-group">table-header-group</option>
                        <option value="table-footer-group">table-footer-group</option>
                        <option value="table-caption">table-caption</option>
                    
                        <!-- Weitere Display-Werte -->
                        <option value="inline-table">inline-table</option>
                        <option value="run-in">run-in</option>
                        <option value="contents">contents</option>
                        <option value="none">none</option>
                    
                        <!-- Neue Werte für komplexe Layouts -->
                        <option value="flow-root">flow-root</option>
                        <option value="subgrid">subgrid</option> <!-- experimentell -->
                        
                        <!-- Multicontainer und -Overlay -->
                        <option value="ruby">ruby</option>
                        <option value="ruby-base">ruby-base</option>
                        <option value="ruby-text">ruby-text</option>
                        <option value="ruby-base-container">ruby-base-container</option>
                        <option value="ruby-text-container">ruby-text-container</option>
                    
                        <!-- Verbundene Werte (z.B. für Web Components) -->
                        <option value="revert">revert</option>
                        <option value="inherit">inherit</option>
                        <option value="initial">initial</option>
                        <option value="unset">unset</option>
                    </select>
                </div>
                <div class="crow">
                    <p>Inhalt Ausrichten:<br><span class="element-info bi bi-info-circle"> (Anzeige: flex)</span></p>
                    <select id="tool-justify-content">
                        <option value="start">start (Standard)</option>
                        <option value="end">end</option>
                        <option value="left">left</option>
                        <option value="right">right</option>
                        <option value="flex-start">flex-start</option>
                        <option value="flex-end">flex-end</option>
                        <option value="center">center</option>
                        <option value="space-between">space-between</option>
                        <option value="space-around">space-around</option>
                        <option value="space-evenly">space-evenly</option>
                    </select>
                </div>
                <div class="crow">
                    <p>Ausrichtung der Elemente:<br><span class="element-info bi bi-info-circle"> (Anzeige: flex)</span></p>
                    <select id="tool-align-items">
                        <option value="start">start (Standard)</option>
                        <option value="end">end</option>
                        <option value="center">center</option>
                        <option value="stretch">stretch</option>
                        <option value="flex-start">flex-start</option>
                        <option value="flex-end">flex-end</option>
                        <option value="baseline">baseline</option>
                        <option value="self-start">self-start</option>
                        <option value="self-end">self-end</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="background"></div>
    </div>
    <script src="/res?f=studio.js"></script>
    <script>
        const sketchyStudio = new SketchyStudio()
        const paths = location.pathname.replace("/", "").split("/")
        console.log("paths", paths)
        const projectName = decodeURI(paths[2 - 1])
        document.title = projectName + " | Sketchy Studio"
        const projectUrl = "/b/project/" + projectName
        let loaded = false
        const dialog = sketchyStudio.createDialog("Lädt", "Das Projekt wird geladen...", ``)

        $(document).ready(async function(){
            let lastProject = localStorage.getItem("lastProject")
            if(lastProject){
                lastProject = JSON.parse(lastProject)
                console.log(lastProject)
                if(lastProject.name == projectName){
                    console.log("loaded project from localStorage")
                    const placeholder = new DOMParser().parseFromString(lastProject.html, "text/html")
                    console.log(placeholder)
                    document.title = placeholder.querySelector("title").innerHTML + " | Sketchy Studio"
                    $("html").attr("lang", placeholder.querySelector("html").getAttribute("lang"))
                    $("head").append([placeholder.querySelector("head").innerHTML, $(document.createElement("style")).html(lastProject.css)])
                    $("sketchystudio").append(placeholder.querySelector("body").innerHTML)
                    $("body").removeClass("default")
                    sketchyStudio.removeDialog(dialog)
                    loaded = true
                }
            }

            if(sketchyStudio.isMobile()){
                const style = $(document.createElement("style"))
                style.html(`
                
                `)
                $("head").append(style)
            }
        })

        window.onload = async function(){
            if(Math.floor(Date.now() - localStorage.getItem("lastCall")) >= 2000){
                localStorage.setItem("lastCall", Date.now())
                let altDialog 
                const lazyTimeout = setTimeout(function(){
                    altDialog = sketchyStudio.createDialog("Lädt", "Das Projekt wird geladen...", ``)
                }, 100)
                let html = await sketchyStudio.authGet(projectUrl + "/files?name=index.html", true)
                let css = await sketchyStudio.authGet(projectUrl + "/files?name=index.css", true)
                clearTimeout(lazyTimeout)
                if(altDialog) sketchyStudio.removeDialog(altDialog)
                if(html.status == 0){
                    sketchyStudio.notify("Fehlgeschlagen", html.err, "error", 10000)
                    console.error(html.err)
                    sketchyStudio.removeDialog(dialog)
                    const dialog2 = sketchyStudio.createDialog("Laden Fehlgeschlagen", "Das laden des Projektes ist fehlgeschlagen, aufgrund folgendes Fehlers:", `<p class="bold">${html.err}</p>`, "error", 450)
                    $(dialog2 + "-cancel").click(function(){
                        sketchyStudio.openSite("/studio")
                    })
                    return
                }
                else{
                    html = html.data
                    css = css.data
                    if(!loaded){
                        const placeholder = new DOMParser().parseFromString(html, "text/html")
                        console.log(placeholder)
                        document.title = placeholder.querySelector("title").innerHTML + " | Sketchy Studio"
                        $("html").attr("lang", placeholder.querySelector("html").getAttribute("lang"))
                        $("head").append(placeholder.querySelector("head").innerHTML)
                        $("sketchystudio").append(placeholder.querySelector("body").innerHTML)
                        if(css.status == 0) sketchyStudio.notify("Fehlgeschlagen", css, "error", 10000)
                        else $("head").append($(document.createElement("style")).html(css))
                    }
                    $("body").removeClass("default")
                    sketchyStudio.removeDialog(dialog)

                    localStorage.setItem("lastProject", JSON.stringify({name: projectName, html, css}))
                    console.log("updated project in localStorage")
                }
                $("head").append($(document.createElement("style")).html(`
                    sketchystudio *:hover, sketchystudio *.active{
                        border-radius: 6px;
                        outline: 1px solid springgreen;
                        cursor: pointer;
                    }
                `))
            }
            else{
                sketchyStudio.notify("Abgebrochen", "Es wurden keine neuen Projekt Daten geladen, da zu viele Anfragen gestellt worden sind.", "warning", 10000)
            }

            $("sketchystudio").children().each(function(i, element){
                $(element).click(() => sketchyStudio.elementClicked(element))
            })
        }
    </script>
</body>
</html>